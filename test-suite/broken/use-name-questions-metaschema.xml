<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/css" href="../../../support/lib/metaschema-author.css"?>
<?xml-model href="../../toolchains/xslt-M4/validate/metaschema-check.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<METASCHEMA xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://csrc.nist.gov/ns/oscal/metaschema/1.0 ../../support/lib/metaschema.xsd"
    xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
    <schema-name>Test Metaschema</schema-name>
    <schema-version>1.0</schema-version>
    <short-name>anthology</short-name>
    <namespace>http://csrc.nist.gov/metaschema/ns/test</namespace>

    <define-assembly name="root">
        <root-name>ROOT</root-name>
        <model>
            <define-assembly name="a">
                <model>
                    <field ref="item" max-occurs="unbounded">
                        <group-as name="a-items"/>
                    </field>
                </model>
            </define-assembly>
            <define-assembly name="z">
                <model>
                    <define-field name="ITEM" max-occurs="unbounded">
                        <group-as name="b-items"/>
                        <constraint>
                            <allowed-values target=".">
                                <enum value="1"/>
                                <enum value="2"/>
                                <enum value="3"/>
                            </allowed-values>
                        </constraint>
                    </define-field>
                </model>
            </define-assembly>

        </model>
        <constraint>
            <!-- Q: what are the applicable targets for this extension? -->
            <allowed-values target=".//ITEM" extends="yes">
                <enum value="a"/>
                <enum value="b"/>
                <enum value="c"/>
            </allowed-values>
        </constraint>
    </define-assembly>

    <define-field name="item">
        <use-name>ITEM</use-name>
        <constraint>
            <allowed-values target=".">
                <enum value="x"/>
                <enum value="y"/>
                <enum value="z"/>
            </allowed-values>
            <!--how does this combine, or does it? I think it should pre-empt? -->
            <require when="@type='color'">
                <allowed-values target=".">
                    <enum value="red"/>
                    <enum value="blue"/>
                    <enum value="green"/>
                </allowed-values>
                
            </require>
        </constraint>
    </define-field>

</METASCHEMA>
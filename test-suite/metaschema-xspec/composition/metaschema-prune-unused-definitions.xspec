<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               stylesheet="../../../toolchains/xslt-M4/compose/metaschema-prune-unused-definitions-a9.xsl"
               run-as="external"
               xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0"
               xmlns:m="http://csrc.nist.gov/ns/oscal/metaschema/1.0"
               xmlns:mv="http://csrc.nist.gov/ns/metaschema/test/variable">
   
   <!-- no need for helper <x:helper stylesheet="../metaschema-test-helper.xsl"/> -->
   
   <x:scenario label="Unused definitions - reports">
      <x:context>
         <METASCHEMA module="nestedmessy">
            <define-assembly name="unused-assembly" module="nestedmessy" _key-name="nestedmessy:unused-assembly">
               <formal-name>Unused assembly</formal-name>
               <description>Unused assembly</description>
               <model>
                  <field max-occurs="1" min-occurs="0" ref="unused-field" _key-ref="nestedmessy:unused-field"/>
               </model>
            </define-assembly>
            <define-assembly name="BOX" module="nestedmessy" _key-name="nestedmessy:BOX">
               <formal-name>BOX</formal-name>
               <description>An empty box</description>
               <root-name>BOX</root-name>
               <model/>
            </define-assembly>
            <define-field as-type="string" name="unused-field" module="nestedmessy" _key-name="nestedmessy:unused-field">
               <formal-name>Unused field</formal-name>
               <description>Unused field</description>
            </define-field>
         </METASCHEMA>
      </x:context>
      <x:expect label="Unused definitions replaced">
         <METASCHEMA module="nestedmessy">
            <INFO info-type="objects-used">Seeing assembly#nestedmessy:BOX</INFO>
            <EXCEPTION problem-type="unused-definition">REMOVING unused assembly definition for 'unused-assembly' from nestedmessy.</EXCEPTION>
            <define-assembly name="BOX" module="nestedmessy" _key-name="nestedmessy:BOX">
               <formal-name>BOX</formal-name>
               <description>An empty box</description>
               <root-name>BOX</root-name>
               <model/>
            </define-assembly>
            <EXCEPTION problem-type="unused-definition">REMOVING unused field definition for 'unused-field' from nestedmessy.</EXCEPTION>
         </METASCHEMA>
      </x:expect>
      <x:expect label="Detecting two unused fields" test="count($x:result//m:EXCEPTION[@problem-type='unused-definition']) eq 2"/>
      <x:expect label="Seeing unused assembly" test="$x:result//m:EXCEPTION[@problem-type='unused-definition'] = 'REMOVING unused assembly definition for ''unused-assembly'' from nestedmessy.'"/>
      <x:expect label="Seeing unused field" test="$x:result//m:EXCEPTION[@problem-type='unused-definition'] = 'REMOVING unused field definition for ''unused-field'' from nestedmessy.'"/>
   </x:scenario>
   
   
</x:description>
